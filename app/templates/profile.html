<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

{% extends 'base.html' %}

{% block title %}Личный кабинет — ArtNails Academy{% endblock %}

{% if session.get('logged_out') %}
    <p>Вы вышли. Для доступа к профилю войдите снова.</p>
{% else %}
    <div class="profile-page">
        <!-- весь профиль здесь -->
    </div>
{% endif %}


{% block content %}

<div class="profile-page">
    <!-- Белый верхний блок -->
    <div class="profile-header">
        <div class="profile-header-text">
            <h1>Личный кабинет</h1>
            <p>Управляйте своим обучением</p>
        </div>
        <button class="btn-buy-course">+ Купить курс</button>
    </div>

    <!-- Основной контент -->
    <div class="profile-content">
        <!-- Карточка пользователя -->
        <div class="profile-card">
            <!-- Аватар -->
            <img src="{{ url_for('static', filename=user.avatar) if user.avatar else url_for('static', filename='img/default_avatar.png') }}"
                 alt="Аватар" class="profile-avatar">
            <div class="profile-user-info">
                <h2>{{ user.first_name }} {{ user.last_name }}</h2>
                <p class="profile-email">{{ user.email }}</p>
                <p class="profile-role">Студент с {{ user.registration_date.strftime('%d %B %Y') }}</p>
            </div>

            <!-- Статистика -->
            <div class="profile-stats">
                <div class="stat stat-purchased">
                    <div class="stat-number">{{ stats['courses'] }}</div>
                    <div class="stat-label">Курсов куплено</div>
                </div>
                <div class="stat stat-completed">
                    <div class="stat-number">{{ stats['completed'] }}</div>
                    <div class="stat-label">Курсов завершено</div>
                </div>
                <div class="stat stat-certificates">
                    <div class="stat-number">{{ stats['certificates'] }}</div>
                    <div class="stat-label">Сертификатов</div>
                </div>
            </div>

            <!-- Кнопки вкладок -->
            <div class="profile-buttons">
                <button class="tab-btn active" data-tab="my-courses">Мои курсы</button>
                <button class="tab-btn" data-tab="certificates">Сертификаты</button>
                <button class="tab-btn" data-tab="profile-info">Профиль</button>
            </div>
        </div>

        <!-- Блоки контента справа, меняются через JS -->
          <div id="tab-content">
            <div class="my-courses" style="display:block;">
                <h2 class="tab-title">Мои курсы</h2>

                <div class="courses-grid">
                    {% for course in courses %}
                    <div class="course-card">
                        <!-- Картинка -->
                        <img src="{{ url_for('static', filename=course.image) }}"
                             alt="Курс"
                             class="course-image">

                        <!-- Уровень -->
                        <div class="course-info">
                            <div class="course-level-row">
                                <div class="course-level {{ course.difficulty|lower }}">
                                    {{ course.difficulty }}
                                </div>

                                {% if course.status == 'completed' %}
                                    <div class="course-certificate">Сертификат готов</div>
                                {% endif %}
                            </div>

                            <!-- НАЗВАНИЕ КУРСА (ВАЖНО) -->
                            <div class="course-title">
                                {{ course.title }}
                            </div>

                            <!-- КРАТКОЕ ОПИСАНИЕ -->
                            <div class="course-desc">
                                {{ course.short_description }}
                            </div>
                        </div>
                        <!-- ПРОГРЕСС -->
                        <div class="course-progress-info">
                            <span>Прогресс</span>
                            <span>{{ course.completed_modules }}/{{ course.total_modules }} модулей</span>
                        </div>

                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ course.progress }}%;"></div>
                        </div>

                        <div class="progress-percent">{{ course.progress }}%</div>

                        <!-- МЕТА -->
                        <div class="course-meta">
                            <span>
                                Преподаватель: {{ course.teacher }}
                            </span>
                            <span>
                                {{ course.purchase_date.strftime('%d.%m.%Y') }}
                            </span>
                        </div>

                        <!-- КНОПКИ -->
                        {% if course.status != 'completed' %}
                            <button class="btn-continue">
                                <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <!-- Пример иконки: стрелка вправо -->
                                    <path d="M4 2L12 8L4 14V2Z"/>
                                </svg>
                                Продолжить
                            </button>
                        {% else %}
                            <div class="course-buttons">
                                <button class="btn-view">
                                    <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <!-- Иконка глаза -->
                                        <path d="M8 3C4 3 1.333 8 8 13C14.667 8 12 3 8 3ZM8 11C6.343 11 5 9.657 5 8C5 6.343 6.343 5 8 5C9.657 5 11 6.343 11 8C11 9.657 9.657 11 8 11ZM8 6C7.447 6 7 6.447 7 7C7 7.553 7.447 8 8 8C8.553 8 9 7.553 9 7C9 6.447 8.553 6 8 6Z"/>
                                    </svg>
                                    Посмотреть
                                </button>
                                    <button class="btn-certificate">
                                        <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <!-- Иконка скачивания -->
                                            <path d="M4 8H7V12H9V8H12L8 4L4 8Z"/>
                                        </svg>
                                        Сертификат
                                    </button>
                            </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

    </div>
</div>

<!-- JS -->
<script src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endblock %}