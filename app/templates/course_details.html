{% extends "base.html" %}

{% block title %}{{ course.title }} | ArtNails Academy{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/course_tabs.js') }}"></script>
{% endblock %}

{% block content %}
<section class="course-hero">

    <div class="course-hero__container">

        <!-- ЛЕВЫЙ ТЕКСТОВЫЙ БЛОК -->
        <div class="course-hero__info">

            <!-- рейтинг -->
            <div class="course-hero__rating">
                <img src="{{ url_for('static', filename='icons/star.svg') }}" alt="rating">
                <span>{{ avg_rating|round(1) }}</span>
                <span>({{ reviews_count }} отзывов)</span>
            </div>

            <!-- название -->
            <h1 class="course-hero__title">
                {{ course.title }}
            </h1>

            <!-- краткое описание -->
            <p class="course-hero__description">
                {{ course.short_description }}
            </p>

            <!-- данные курса -->
            <div class="course-hero__meta">
                <div class="meta-item">
                    <img src="{{ url_for('static', filename='icons/clock.svg') }}" alt="clock" class="icon-small">
                    <span>{{ course.duration_weeks }} недель</span>
                </div>

                <div class="meta-item">
                    <img src="{{ url_for('static', filename='icons/level.svg') }}" alt="level" class="icon-small">
                    <span>{{ course.difficulty }}</span>
                </div>
            </div>

            <!-- преподаватель -->
            <div class="course-hero__teacher">
                <img src="{{ url_for('static', filename=course.teacher.photo) }}" alt="teacher">
                <div>
                    <div class="teacher-name">
                        {{ course.teacher.first_name }} {{ course.teacher.last_name }}
                    </div>
                    <div class="teacher-position">
                        {{ course.teacher.position }}
                    </div>
                </div>
            </div>

        </div>

        <!-- ПРАВАЯ КАРТОЧКА -->
        <div class="course-hero__card">

                    <img class="course-card__image"
             src="{{ url_for('static', filename=course.image) }}"
             alt="{{ course.title }}">


            <div class="course-card__prices">
                <span class="price-current">{{ course.price }} BYN</span>

                {% if old_price %}
                    <span class="price-old">{{ old_price }} BYN</span>
                {% endif %}

                {% if discount %}
                    <span class="price-discount">
                        Скидка {{ discount }}%
                    </span>
                {% endif %}
            </div>



            <button class="course-card__btn" onclick="window.location.href='{{ url_for('enroll.enroll_page') }}'">
                Записаться на курс
            </button>

            <div class="course-card__guarantee">
                30-дневная гарантия возврата денег
            </div>

            <div class="course-card__divider"></div>

            <div class="course-card__includes">
                <div class="includes-title">
                    Этот курс включает:
                </div>
                <ul>
                    <li>{{ video_count }} видео уроков в HD качестве</li>
                    <li>Практические задания с проверкой</li>
                    <li>Сертификат о прохождении курса</li>
                    <li>Доступ к материалам на 1 год</li>
                    <li>Поддержка преподавателя</li>
                    <li>Закрытое сообщество студентов</li>
                </ul>
            </div>

        </div>

    </div>

</section>


<!-- =========================
     Вкладки курса
   ========================= -->
<section class="course-tabs-section">

    <!-- Вкладки -->
    <div class="tabs-header">
        <div class="tab active" data-tab="overview">Обзор</div>
        <div class="tab" data-tab="program">Программа</div>
        <div class="tab" data-tab="teacher">Преподаватель</div>
        <div class="tab" data-tab="reviews">Отзывы</div>
        <div class="active-line"></div>
    </div>

    <!-- Линия под вкладками на всю ширину -->
    <div class="tabs-line"></div>

    <!-- Контент всех вкладок -->
    <div class="tabs-content-wrapper">

        <!-- ===== Обзор ===== -->
        <div id="overview-content" class="tab-content active">

            <div class="overview-wrapper" style="display: flex; gap: 32px; align-items: flex-start;">

                <!-- Левая часть: текст -->
                <div class="overview-text">

                    <h2 class="tab-section-title">О курсе</h2>
                    <p class="tab-section-text">{{ course.details.full_description }}</p>

                    <h2 class="tab-section-title">Чему вы научитесь</h2>
                    <div class="learning-outcomes">
                        {% set outcomes = course.details.learning_outcomes.split(';') %}
                        <div class="column">
                            {% for item in outcomes[:(outcomes|length // 2 + outcomes|length % 2)] %}
                                <p>• {{ item }}</p>
                            {% endfor %}
                        </div>
                        <div class="column">
                            {% for item in outcomes[(outcomes|length // 2 + outcomes|length % 2):] %}
                                <p>• {{ item }}</p>
                            {% endfor %}
                        </div>
                    </div>

                    <h2 class="tab-section-title">Требования</h2>
                    <div class="requirements">
                        {% for req in course.details.requirements.split(';') %}
                            <p>{{ req }}</p>
                        {% endfor %}
                    </div>

                </div>

        <!-- Правая часть: блок статистики -->
                <div class="course-stats-card">
                    <div class="course-stats-row">
                        <div class="value">Статистика курса</div>
                        <div class="value"></div>
                    </div>
                    <div class="course-stats-row">
                        <span class="label">Студентов:</span>
                        <span class="value">{{ student_count }}</span>
                    </div>
                    <div class="course-stats-row">
                        <span class="label">Рейтинг:</span>
                        <span class="value">
                            {{ avg_rating }}
                            <img src="{{ url_for('static', filename='icons/star.svg') }}" alt="star" style="width:24px; height:24px; vertical-align:middle;">
                        </span>
                    </div>
                    <div class="course-stats-row">
                        <span class="label">Отзывов:</span>
                        <span class="value">{{ reviews_count }}</span>
                    </div>
                    <div class="course-stats-row">
                        <span class="label">Длительность:</span>
                        <span class="value">{{ course.duration_weeks }} недель</span>
                    </div>
                </div>

            </div> <!-- .overview-wrapper -->

        </div> <!-- #overview-content -->

        <!-- ===== Программа ===== -->
        <div id="program-content" class="tab-content">

            <h2 class="tab-section-title">Программа курса</h2>

            <div class="modules-wrapper">
                {% for module in course.modules|sort(attribute='order_index') %}
                    <div class="module-card">
                        <img class="module-icon"
                             src="{{ url_for('static', filename='icons/' + ('book.svg' if module.type=='theory' else 'tools.svg' if module.type=='practice' else 'question.svg')) }}"
                             alt="{{ module.type }}">
                        <div class="module-title">{{ module.title }}</div>
                        <img class="module-lock" src="{{ url_for('static', filename='icons/lock.svg') }}" alt="lock">
                    </div>
                {% endfor %}
            </div>

        </div>

        <!-- ===== Преподаватель ===== -->
        <div id="teacher-content" class="tab-content">
            <h2 class="tab-section-title">Ваш преподаватель</h2>

            <div class="teacher-card">
                <!-- Фото -->
                <img class="teacher-photo" src="{{ url_for('static', filename=course.teacher.photo) }}" alt="Преподаватель">

                <!-- Правая часть с именем и опытом -->
                <div class="teacher-info">
                    <div class="teacher-name">
                        {{ course.teacher.first_name }} {{ course.teacher.last_name }}
                    </div>
                    <div class="teacher-experience">
                        <span>Опыт работы</span><br>
                        <span class="experience-years">{{ course.teacher.experience_years }} лет</span>
                    </div>
                </div>

                <!-- Био под фото -->
                <div class="teacher-bio">
                    {{ course.teacher.bio }}
                </div>
            </div>
        </div>



        <!-- ===== Отзывы ===== -->
        <div id="reviews-content" class="tab-content">
            <h2 class="tab-section-title">Отзывы студентов</h2>

            <div class="reviews-list">
                {% for review in course.reviews %}
                <div class="review-card">
                    <img
                        class="review-avatar"
                        src="{{ url_for('static', filename=review.user.avatar) if review.user.avatar else url_for('static', filename='img/default_avatar.png') }}"
                        alt="avatar"
                    >
                    <div class="review-header">
                        <div class="review-name">{{ review.user.first_name }} {{ review.user.last_name }}</div>
                        <div class="review-course">{{ course.title }}</div>
                    </div>
                    <div class="review-stars">
                        {% for i in range(1,6) %}
                            {% if i <= review.rating %}
                                <img src="{{ url_for('static', filename='icons/star-filled.svg') }}" alt="star" class="star">
                            {% else %}
                                <img src="{{ url_for('static', filename='icons/star-empty.svg') }}" alt="star" class="star">
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="review-date">{{ review.created_at.strftime("%d.%m.%Y") }}</div>
                    <p class="review-text">{{ review.comment }}</p>
                </div>
                {% endfor %}
            </div>
        </div>




    </div> <!-- .tabs-content-wrapper -->

</section>

<script>
// ==========================
// Плавное появление всей страницы и элементов hero
// ==========================
document.addEventListener('DOMContentLoaded', () => {
    const heroInfo = document.querySelector('.course-hero__info');
    const heroCard = document.querySelector('.course-hero__card');

    [heroInfo, heroCard].forEach(el => {
        el.style.opacity = 0;
        el.style.transform = "translateY(20px)";
    });

    setTimeout(() => {
        heroInfo.style.transition = heroCard.style.transition = "all 0.8s ease";
        heroInfo.style.opacity = 1; heroInfo.style.transform = "translateY(0)";
        heroCard.style.opacity = 1; heroCard.style.transform = "translateY(0)";
    }, 100);
});

// ==========================
// Анимация звезд рейтинга на странице
// ==========================
document.addEventListener('DOMContentLoaded', () => {
    const reviewCards = document.querySelectorAll('.review-card');

    reviewCards.forEach(card => {
        const rating = parseInt(card.dataset.rating);
        const stars = card.querySelectorAll('.review-rating .star');

        stars.forEach((star, index) => {
            star.src = index < rating
                ? star.dataset.yellow || '/static/icons/star-yellow.svg'
                : star.dataset.gray || '/static/icons/star-gray.svg';
        });

        stars.forEach((star, index) => {
            star.addEventListener('mouseenter', () => {
                stars.forEach((s, i) => {
                    s.src = i <= index
                        ? s.dataset.yellow || '/static/icons/star-yellow.svg'
                        : s.dataset.gray || '/static/icons/star-gray.svg';
                    s.style.transform = 'scale(1.2)';
                });
            });

            star.addEventListener('mouseleave', () => {
                stars.forEach((s, i) => {
                    s.src = i < rating
                        ? s.dataset.yellow || '/static/icons/star-yellow.svg'
                        : s.dataset.gray || '/static/icons/star-gray.svg';
                    s.style.transform = 'scale(1)';
                });
            });
        });
    });
});

</script>



{% endblock %}
